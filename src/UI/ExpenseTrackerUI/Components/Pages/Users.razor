@page "/users"
@attribute [Authorize(Roles = "SystemAdmin,TenantAdmin")]
@rendermode InteractiveServer

@using ExpenseTrackerUI.Services.User
@using ExpenseTrackerUI.Components.Shared
@inject UserService UserService

<h3>User Management</h3>

<div class="mb-3">
    <button class="btn btn-primary" disabled>
        <span class="bi bi-person-add"></span> Create User
    </button>
    <button class="btn btn-secondary ms-2" @onclick="ShowBulkCreateModal">
        <span class="bi bi-upload"></span> Bulk Create
    </button>
</div>

@if (successMessage != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        @successMessage
        <button type="button" class="btn-close" @onclick="() => successMessage = null"></button>
    </div>
}

<p class="text-muted">User listing coming soon...</p>

<BulkCreateUsersModal @ref="bulkCreateModal" OnUploadCompleted="HandleBulkUploadCompleted" />

@code {
    private BulkCreateUsersModal? bulkCreateModal;
    private string? successMessage;

    private async Task ShowBulkCreateModal()
    {
        if (bulkCreateModal != null)
        {
            await bulkCreateModal.Show();
        }
    }

    private void HandleBulkUploadCompleted(BulkCreateUsersResponse result)
    {
        successMessage = $"Bulk upload completed: {result.SuccessCount} created, " +
                        $"{result.AlreadyExistedCount} already existed, " +
                        $"{result.FailedCount} failed";
        StateHasChanged();
    }
}
